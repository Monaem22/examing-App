import{r as o,A as L,j as e,L as M,f as $,k as F,y as c}from"./index-BvLg1fWM.js";import{H}from"./Helmet-BZH04Yzz.js";import{a as S}from"./api-sjr0-pHH.js";import{I}from"./index-Ci69w3Nc.js";function R(){var E;const{examId:r,setExamId:f}=o.useContext(L),[T,u]=o.useState(!1),[t,m]=o.useState(null),[x,b]=o.useState(""),[h,g]=o.useState(""),[j,v]=o.useState(""),[p,w]=o.useState(""),[N,y]=o.useState("");o.useEffect(()=>{const s=sessionStorage.getItem("ExamId");!r&&s&&f(s)},[r,f]);async function A(){if(r)try{u(!0);let{data:s}=await S.get(`/api/exam/get-exam/${r}`);c.success("تم جلب تفاصيل الامتحان بنجاح."),m(s.data),u(!1)}catch{c.error("حدثت مشكلة أثناء جلب تفاصيل الامتحان!"),u(!1)}}o.useEffect(()=>{A()},[r]);function D(){b(t.title),g(t.description),v(t.date),w(t.time),y(t.duration)}async function _(){if(r)try{await S.put(`/api/exam/update-exam/${r}`,{title:x,description:h,date:j,time:p,duration:N,questions:t.questions}),m(s=>({...s,title:x,description:h,date:j,time:p,duration:N,questions:s.questions})),c.success("تم تعديل الامتحان بنجاح.")}catch(s){if(console.error("Error updating exam:",s),s.response){const n=s.response.data.message;n.includes("هذا الوقت من الماضي اجعله في المستقبل")?c.error("وقت الامتحان غير صحيح، الرجاء تحديد وقت في المستقبل!"):n.includes("exams_table validation failed: questions.1.subQuestions.2.questionText")?c.error("لا يمكن تعديل الامتحان وبه خانات فارغة!"):c.error("حدثت مشكلة أثناء محاولة التعديل، تحقق من الاسألة المعدلة!")}else c.error("حدث خطأ أثناء الاتصال بالخادم، تأكد من اتصالك بالإنترنت!")}}return T?e.jsx(M,{}):e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsx("title",{children:"تفاصيل الامتحان"})}),e.jsx("section",{className:"exam-details my-5 py-4",children:e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"d-flex justify-content-center mt-2 mb-3",children:e.jsx($,{to:"/all-exams",className:"redirect-link",children:e.jsxs("button",{className:"btn px-4 rounded-0 fs-6",children:["الرجوع الى جميع الامتحانات",e.jsx(I,{size:18,className:"mx-2"})]})})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"fw-bold mt-4 dash-header",children:"📚 تفاصيل الامتحان :"}),e.jsxs("button",{className:"btn d-flex align-items-center justify-content-center gap-1 mt-2 rounded-0","data-bs-toggle":"modal","data-bs-target":"#updateExamModal",onClick:D,children:["تعديل الامتحان",e.jsx(F,{})]})]}),t?e.jsxs("div",{className:"card p-3 shadow-sm rounded-3 mt-4",children:[e.jsx("div",{className:"card-header text-white fw-bold main-bg",children:t.title}),e.jsxs("ul",{className:"list-group list-group-flush",children:[e.jsxs("li",{className:"list-group-item",children:[e.jsx("strong",{className:"text-muted",children:"📜 الوصف:"})," ",t.description]}),e.jsxs("li",{className:"list-group-item",children:[e.jsx("strong",{className:"text-muted",children:"📅 التاريخ:"})," ",t.date]}),e.jsxs("li",{className:"list-group-item",children:[e.jsx("strong",{className:"text-muted",children:"⏰ الوقت:"})," ",t.time]}),e.jsxs("li",{className:"list-group-item",children:[e.jsx("strong",{className:"text-muted",children:"⌛ المدة:"})," ",t.duration]}),e.jsxs("li",{className:"list-group-item",children:[e.jsx("strong",{className:"text-muted",children:"❓ عدد الأسئلة:"})," ",t.totalQuestions]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:"fw-bold",children:"📌 الأسئلة:"}),t.questions.map((s,n)=>e.jsxs("div",{className:"mt-3 p-3 exam-details-questions rounded",children:[e.jsxs("h6",{className:"fw-bold main-bg p-2 text-white",children:[n+1,". ",s.question_title]}),e.jsx("ul",{className:"list-unstyled mt-2",children:s.subQuestions.map((l,d)=>e.jsxs("li",{className:"mb-2 list-questions",children:[e.jsxs("strong",{className:"text-muted",children:[n+1,".",d+1," ",l.questionText]}),e.jsx("ul",{className:"mt-1",children:l.options.map((i,a)=>e.jsxs("li",{className:`ms-3 ${i===l.correctAnswer?"text-success fw-bold":""}`,children:["- ",i]},a))}),e.jsxs("p",{className:"mt-2 text-success fw-bold",children:["✅ الإجابة الصحيحة: ",l.correctAnswer]})]},l._id))})]},s._id))]})]}):e.jsx("div",{className:"text-center text-danger fw-bold mt-3",children:e.jsx("p",{children:"لم يتم العثور على تفاصيل الامتحان."})})]})}),e.jsx("div",{className:"modal fade",id:"updateExamModal",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header d-flex justify-content-between",children:[e.jsx("button",{type:"button",className:"btn-close ms-auto","data-bs-dismiss":"modal"}),e.jsx("h5",{className:"modal-title",children:"تعديل بيانات الامتحان"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("label",{className:"form-label",children:"عنوان الامتحان:"}),e.jsx("input",{type:"text",className:"form-control",value:x,onChange:s=>b(s.target.value)}),e.jsx("label",{className:"form-label mt-3",children:"وصف الامتحان:"}),e.jsx("input",{className:"form-control",value:h,onChange:s=>g(s.target.value)}),e.jsx("label",{className:"form-label mt-3",children:"تاريخ الامتحان:"}),e.jsx("input",{type:"text",className:"form-control",value:j,onChange:s=>v(s.target.value)}),e.jsx("label",{className:"form-label mt-3",children:"وقت الامتحان:"}),e.jsx("input",{type:"text",className:"form-control",value:p,onChange:s=>w(s.target.value)}),e.jsx("label",{className:"form-label mt-3",children:"مدة الامتحان:"}),e.jsx("input",{type:"text",className:"form-control",value:N,onChange:s=>y(s.target.value)}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:"fw-bold",children:"تعديل الأسئلة:"}),(E=t==null?void 0:t.questions)==null?void 0:E.map((s,n)=>e.jsxs("div",{className:"mt-3 p-3 exam-details-questions rounded",children:[e.jsxs("h6",{className:"fw-bold main-bg p-2 text-white",children:[n+1,". ",s.question_title]}),s.subQuestions.map((l,d)=>e.jsxs("div",{className:"mt-3 p-2 border rounded",children:[e.jsx("label",{className:"form-label mt-2 fw-bold",children:"نص السؤال:"}),e.jsx("input",{type:"text",className:"form-control my-2",placeholder:"أدخل نص السؤال",value:l.questionText||"",onChange:i=>{const a=[...t.questions];a[n].subQuestions[d].questionText=i.target.value,m({...t,questions:a})}}),e.jsxs("div",{className:"my-3",children:[e.jsx("label",{className:"fw-bold",children:"الاختيارات :"}),e.jsx("div",{className:"row",children:l.options.map((i,a)=>e.jsx("div",{className:"col-4",children:e.jsx("input",{type:"text",className:"form-control my-2",placeholder:`اختيار ${a+1}`,value:i,onChange:k=>{const q=[...l.options];q[a]=k.target.value;const C=[...t.questions];C[n].subQuestions[d].options=q,m({...t,questions:C})}})},a))})]}),e.jsxs("div",{className:"my-3",children:[e.jsx("label",{className:"fw-bold",children:"الإجابة الصحيحة :"}),e.jsxs("select",{className:"form-select my-2",value:l.correctAnswer||"",onChange:i=>{const a=[...t.questions];a[n].subQuestions[d].correctAnswer=i.target.value,m({...t,questions:a})},children:[e.jsx("option",{value:"",disabled:!0,hidden:!0,children:"اختر الإجابة الصحيحة"}),l.options.map((i,a)=>e.jsx("option",{value:i,children:i},a))]})]})]},d))]},s._id))]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn rounded-0","data-bs-dismiss":"modal",children:"إغلاق"}),e.jsx("button",{type:"button",className:"btn rounded-0",onClick:_,"data-bs-dismiss":"modal",children:"حفظ التعديلات"})]})]})})})]})}export{R as default};
